<html>
    <head>
        <link rel="stylesheet" href="../common/css/style.css" />
        <link rel="stylesheet" href="./style.css" />
    <style>
    #example {
        padding: 4em;
    }

    </style>
    </head>

    <body>
        <div id="example">
            <div>
                <div>Press start to create windows</div>
                <button id="start">Start</button>
            </div>
            <div class="hide">
                <div>Press stop to close windows</div>
                <button id="stop">Stop</button>
            </div>
        </div>
    </body>
    </html>
    <script type="module">
        import { createChildWindow } from './child-windows.js';
        import { createLogger, createLogManager } from './logger.js';

        const logManager = await createLogManager();
        let log = createLogger("Main");
        log.debug("Running");
        log.info("info message");
        log.warn("warn message");
        log.error("error message");
        let controlWindow = null;
        let drawWindow = null;

        const stopButton = document.getElementById('stop');
        const startButton = document.getElementById('start');

        function rotateText(event) {
            const value = event.target.value-180;
            log.info(`rotate: ${value}`);

            const textElement = drawWindow.querySelector('.draw-text');
            const transform = `rotate(${value}deg)`;
            textElement.style.transform = transform;

        }

        function changeText(event) {
            const value = event.target.value;
            log.info(`change text: ${value}`);
            const textElement = drawWindow.querySelector('.draw-text');
            textElement.innerText = value;
        }

        function createControlListeners(){
            controlWindow.querySelector(`input[name='rotation']`)
                        .addEventListener('input',rotateText);
            controlWindow.querySelector(`input[name='text']`)
                        .addEventListener('input', changeText);
        }

        function closeWindows() {
            log.info("close windows");
            controlWindow?.close();
            drawWindow?.close();
            startButton.parentElement.classList.remove('hide');
            stopButton.parentElement.classList.add('hide');
        }

        async function openWindows() {
            log.info("open windows");

            drawWindow = await createChildWindow("Draw", "draw.html");
            controlWindow = await createChildWindow("Control", "control.html");
            createControlListeners();
            startButton.parentElement.classList.add('hide');
            stopButton.parentElement.classList.remove('hide');

        }

        startButton.addEventListener('click',()=>{
            closeWindows();
            openWindows();
        });

        stopButton.addEventListener('click', () => {
            closeWindows();
        });

        window.addEventListener('beforeunload', () => {
               logManager?.close();
               controlWindow?.close();
               drawWindow?.close();
            });
    </script>
</html>